{
  "version": 3,
  "sources": ["projects/client/src/app/core/services/auth.service.ts"],
  "sourcesContent": ["import { Injectable } from '@angular/core';\nimport { Router } from '@angular/router';\nimport { BehaviorSubject, Observable, of } from 'rxjs';\nimport { map, tap } from 'rxjs/operators';\nimport { ApiService } from './api.service';\nimport { StorageService } from './storage.service';\nimport { NotificationService } from './notification.service';\nimport { User } from '@models/user.model';\nimport {\n  LoginRequest,\n  RegisterRequest,\n  AuthResponse,\n  ForgotPasswordRequest,\n  ResetPasswordRequest,\n  ChangePasswordRequest\n} from '@models/auth.model';\nimport { ApiResponse } from '@models/api-response.model';\nimport { environment } from '@environments/environment';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class AuthService {\n  private currentUserSubject: BehaviorSubject<User | null>;\n  public currentUser$: Observable<User | null>;\n  \n  private isAuthenticatedSubject: BehaviorSubject<boolean>;\n  public isAuthenticated$: Observable<boolean>;\n\n  constructor(\n    private apiService: ApiService,\n    private storageService: StorageService,\n    private notificationService: NotificationService,\n    private router: Router\n  ) {\n    const user = this.storageService.getObject<User>(environment.userKey);\n    this.currentUserSubject = new BehaviorSubject<User | null>(user);\n    this.currentUser$ = this.currentUserSubject.asObservable();\n\n    this.isAuthenticatedSubject = new BehaviorSubject<boolean>(!!user);\n    this.isAuthenticated$ = this.isAuthenticatedSubject.asObservable();\n  }\n\n  /**\n   * Get current user value\n   */\n  get currentUserValue(): User | null {\n    return this.currentUserSubject.value;\n  }\n\n  /**\n   * Get authentication status\n   */\n  get isAuthenticated(): boolean {\n    return this.isAuthenticatedSubject.value;\n  }\n\n  /**\n   * Get auth token\n   */\n  get token(): string | null {\n    return this.storageService.getItem(environment.tokenKey);\n  }\n\n  /**\n   * Login user\n   */\n  login(credentials: LoginRequest): Observable<ApiResponse<AuthResponse>> {\n    return this.apiService.post<AuthResponse>('/auth/login', credentials)\n      .pipe(\n        tap(response => {\n          if (response.success && response.data) {\n            this.setSession(response.data);\n            this.notificationService.success('Login successful!');\n          }\n        })\n      );\n  }\n\n  /**\n   * Register new user\n   */\n  register(userData: RegisterRequest): Observable<ApiResponse<AuthResponse>> {\n    return this.apiService.post<AuthResponse>('/auth/register', userData)\n      .pipe(\n        tap(response => {\n          if (response.success && response.data) {\n            this.setSession(response.data);\n            this.notificationService.success('Registration successful!');\n          }\n        })\n      );\n  }\n\n  /**\n   * Logout user\n   */\n  logout(): void {\n    // Call logout API (optional)\n    this.apiService.post('/auth/logout', {}).subscribe({\n      next: () => {\n        this.clearSession();\n        this.router.navigate(['/auth/login']);\n        this.notificationService.info('Logged out successfully');\n      },\n      error: () => {\n        // Clear session even if API call fails\n        this.clearSession();\n        this.router.navigate(['/auth/login']);\n      }\n    });\n  }\n\n  /**\n   * Forgot password\n   */\n  forgotPassword(data: ForgotPasswordRequest): Observable<ApiResponse> {\n    return this.apiService.post('/auth/forgot-password', data)\n      .pipe(\n        tap(response => {\n          if (response.success) {\n            this.notificationService.success('Password reset link sent to your email');\n          }\n        })\n      );\n  }\n\n  /**\n   * Reset password\n   */\n  resetPassword(data: ResetPasswordRequest): Observable<ApiResponse> {\n    return this.apiService.post('/auth/reset-password', data)\n      .pipe(\n        tap(response => {\n          if (response.success) {\n            this.notificationService.success('Password reset successful');\n          }\n        })\n      );\n  }\n\n  /**\n   * Change password\n   */\n  changePassword(data: ChangePasswordRequest): Observable<ApiResponse> {\n    return this.apiService.post('/auth/change-password', data)\n      .pipe(\n        tap(response => {\n          if (response.success) {\n            this.notificationService.success('Password changed successfully');\n          }\n        })\n      );\n  }\n\n  /**\n   * Refresh token\n   */\n  refreshToken(): Observable<ApiResponse<AuthResponse>> {\n    const refreshToken = this.storageService.getItem(environment.refreshTokenKey);\n    \n    if (!refreshToken) {\n      return of({ success: false, message: 'No refresh token available' });\n    }\n\n    return this.apiService.post<AuthResponse>('/auth/refresh', { refreshToken })\n      .pipe(\n        tap(response => {\n          if (response.success && response.data) {\n            this.updateToken(response.data.token);\n          }\n        })\n      );\n  }\n\n  /**\n   * Get current user profile\n   */\n  getCurrentUser(): Observable<ApiResponse<User>> {\n    return this.apiService.get<User>('/user/profile')\n      .pipe(\n        tap(response => {\n          if (response.success && response.data) {\n            this.updateUser(response.data);\n          }\n        })\n      );\n  }\n\n  /**\n   * Check if user has specific role\n   */\n  hasRole(role: string): boolean {\n    const user = this.currentUserValue;\n    if (!user) return false;\n    \n    if (user.roles) {\n      return user.roles.includes(role);\n    }\n    return user.role === role;\n  }\n\n  /**\n   * Check if user has any of the specified roles\n   */\n  hasAnyRole(roles: string[]): boolean {\n    return roles.some(role => this.hasRole(role));\n  }\n\n  /**\n   * Set authentication session\n   */\n  private setSession(authData: AuthResponse): void {\n    this.storageService.setItem(environment.tokenKey, authData.token);\n    \n    if (authData.refreshToken) {\n      this.storageService.setItem(environment.refreshTokenKey, authData.refreshToken);\n    }\n    \n    this.storageService.setObject(environment.userKey, authData.user);\n    this.currentUserSubject.next(authData.user);\n    this.isAuthenticatedSubject.next(true);\n  }\n\n  /**\n   * Update token only\n   */\n  private updateToken(token: string): void {\n    this.storageService.setItem(environment.tokenKey, token);\n  }\n\n  /**\n   * Update user data\n   */\n  private updateUser(user: User): void {\n    this.storageService.setObject(environment.userKey, user);\n    this.currentUserSubject.next(user);\n  }\n\n  /**\n   * Clear authentication session\n   */\n  private clearSession(): void {\n    this.storageService.removeItem(environment.tokenKey);\n    this.storageService.removeItem(environment.refreshTokenKey);\n    this.storageService.removeItem(environment.userKey);\n    this.currentUserSubject.next(null);\n    this.isAuthenticatedSubject.next(false);\n  }\n}\n\n"],
  "mappings": "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",
  "names": []
}
