<div class="menu-container">

  <!-- Slider Section -->
  <div class="slider-container w-100 mb-4 mb-md-3" *ngIf="sliderImages && sliderImages.length > 0">
    <div class="slider-wrapper position-relative w-100">
      <button class="slider-nav-btn slider-prev d-none d-md-flex" (click)="prevSlide()" aria-label="Previous slide" type="button">
        <i class="bi bi-chevron-left"></i>
      </button>
      
      <div class="slider-content w-100">
        <div 
          class="slider-slide" 
          *ngFor="let image of sliderImages; let i = index"
          [class.active]="i === currentSlideIndex"
        >
          <img 
            [src]="getSliderImageUrl(image)" 
            [alt]="'Slide ' + (i + 1)"
            (error)="onImageError($event)"
            loading="eager"
            class="w-100 h-100"
          />
        </div>
      </div>
      
      <button class="slider-nav-btn slider-next d-none d-md-flex" (click)="nextSlide()" aria-label="Next slide" type="button">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
    
    <!-- Slider Indicators -->
    <div class="slider-indicators d-flex justify-content-center py-2 py-md-3">
      <button 
        *ngFor="let image of sliderImages; let i = index"
        class="slider-indicator"
        [class.active]="i === currentSlideIndex"
        (click)="goToSlide(i)"
        [attr.aria-label]="'Go to slide ' + (i + 1)"
        type="button"
      ></button>
    </div>
  </div>

  <!-- Category Tabs Section - Now moved to header, hidden here -->
  <!-- <div class="category-tabs-section w-100 mb-3 mb-md-2 mb-lg-4" *ngIf="categories.length > 0">
    <div class="category-tabs-container d-flex align-items-center overflow-auto px-2 px-md-3">
      <button
        class="category-tab"
        [class.active]="activeCategoryId === null"
        (click)="selectCategory(null)"
        type="button"
      >
        All
      </button>
      <button
        *ngFor="let category of categories"
        class="category-tab"
        [class.active]="activeCategoryId === category.id"
        (click)="selectCategory(category.id)"
        type="button"
      >
        {{ category.name }}
      </button>
      <div class="category-arrow d-flex align-items-center justify-content-center px-2 px-md-3">
        <i class="bi bi-chevron-right"></i>
      </div>
    </div>
  </div> -->

  <!-- Loading -->
  <div *ngIf="loading" class="loading-container">
    <div class="spinner-border text-primary" role="status"></div>
    <p class="mt-2">Loading menu items...</p>
  </div>

  <!-- Category Sections -->
  <div *ngIf="!loading && categorySections.length > 0" class="menu-content-wrapper">
    <div class="menu-sections">
      
      <div *ngFor="let section of categorySections" class="category-section" [id]="'category-' + section.category.id">
        
        <!-- Category Heading -->
        <h2 class="category-heading">{{ section.category.name }}</h2>
        
        <!-- Deals Grid for this Category -->
        <div class="deal-grid row g-2 g-md-3 d-md-grid">
          <div *ngFor="let item of section.items" class="deal-card col-12 col-md-6 col-lg-4 me-3" style="cursor: pointer;">
            
            <!-- LEFT: Image -->
            <div class="deal-image d-flex align-items-center justify-content-center" (click)="openProductPopup(item, $event)">
              <img 
                [src]="getImageUrl(item.baseImageUrl)" 
                [alt]="item.name"
                (error)="onImageError($event)"
                class="w-100 h-100 object-fit-cover"
              />
            </div>

            <!-- RIGHT: Content -->
            <div class="deal-content d-flex flex-column" (click)="openProductPopup(item, $event)">
              <div class="deal-header" (click)="openProductPopup(item, $event)">
                <h3 class="deal-title mb-2" (click)="openProductPopup(item, $event)">{{ item.name }}</h3>
                <p class="deal-desc mb-2">
                  {{ truncateDescription(item.description) }}
                </p>
              </div>

              <div class="deal-price">
                <span *ngIf="getItemPrice(item.id)">{{ formatPrice(getItemPrice(item.id)!) }}</span>
                <span *ngIf="!getItemPrice(item.id)" class="price-loading">Loading price...</span>
              </div>
              
              <div class="deal-footer d-flex align-items-center justify-content-between">
                <button 
                  class="deal-btn btn" 
                  (click)="addToCart(item); $event.stopPropagation()"
                  [disabled]="!item.isAvailable"
                  type="button"
                >
                  Add To Cart
                </button>
                <button 
                  class="fav-btn btn border-0 bg-transparent"
                  (click)="toggleFavorite(item.id); $event.stopPropagation()"
                  [class.active]="isFavorite(item.id)"
                  type="button"
                >
                  <i class="bi" 
                     [class.bi-heart]="!isFavorite(item.id)" 
                     [class.bi-heart-fill]="isFavorite(item.id)">
                  </i>
                </button>
              </div>

              
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div *ngIf="!loading && categorySections.length === 0 && menuItems.length === 0" class="empty">
    <i class="bi bi-inbox fs-1 text-muted"></i>
    <h3>No menu items found</h3>
  </div>
</div>


<!-- Simple Popup (Single Portion) -->
<app-product-popup-simple
  *ngIf="showSimplePopup && selectedMenuItemDetail"
  [menuItemDetail]="selectedMenuItemDetail!"
  (close)="onClosePopup()"
  (addToCart)="onAddToCartFromPopup($event)">
</app-product-popup-simple>

<!-- Complex Popup (Multiple Portions) -->
<app-product-popup-complex
  *ngIf="showComplexPopup && selectedMenuItemDetail"
  [menuItemDetail]="selectedMenuItemDetail!"
  (close)="onClosePopup()"
  (addToCart)="onAddToCartFromPopup($event)">
</app-product-popup-complex>
