<!-- Header Section -->
<header class="main-header">
  <!-- Section 1: Logo, Location, Cart, Auth -->
  <div class="header-top-section">
    <div class="header-container">
      <div class="header-top-content">
        <!-- Left Section: Logo + Location -->
        <div class="header-left-group">
          <!-- Logo Section -->
          <div class="header-logo">
            <a routerLink="/menu" class="logo-link">
              <div class="logo-container">
                <div class="logo-circles">
                  <span class="circle"></span>
                  <span class="circle"></span>
                  <span class="circle"></span>
                </div>
                <div class="logo-text">
                  <h1 class="logo-title">M21</h1>
                  <p class="logo-subtitle">KITCHEN</p>
                </div>
                <i class="bi bi-mortarboard-fill logo-icon"></i>
              </div>
            </a>
          </div>

          <!-- Location Section (Right next to logo) -->
          <div class="header-location" (appClickOutside)="closeDropdowns()">
            <button class="location-btn" (click)="toggleLocationDropdown()">
              <i class="bi bi-geo-alt-fill me-2"></i>
              <div class="location-text">
                <span class="location-label">Deliver to <i class="bi bi-chevron-down"></i></span>
                <span class="location-address">{{ deliveryAddress }} {{ estimatedTime }}</span>
              </div>
            </button>
            <!-- Location Dropdown -->
            <div class="location-dropdown" [class.show]="isLocationDropdownOpen">
              <div class="dropdown-content">
                <p class="text-muted">Change delivery location</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Right Section (Cart & Auth) -->
        <div class="header-right">
          <!-- Shopping Cart -->
          <div class="cart-wrapper" (appClickOutside)="closeDropdowns()">
            <button 
              class="cart-btn" 
              (click)="toggleCart()"
              type="button">
              <i class="bi bi-bag"></i>
              <span class="cart-badge" *ngIf="cartItemCount > 0">{{ cartItemCount }}</span>
            </button>
            <!-- Cart Dropdown -->
            <div class="cart-dropdown" [class.show]="isCartOpen">
              <div class="cart-header">
                <h6 class="mb-0">Shopping Cart</h6>
                <span class="badge bg-primary" *ngIf="cartItemCount > 0">{{ cartItemCount }} items</span>
              </div>
              
              <!-- Cart Items -->
              <div class="cart-items" *ngIf="cartItems.length > 0">
                <div class="cart-item" *ngFor="let item of cartItems">
                  <div class="cart-item-image">
                    <img 
                      [src]="getImageUrl(item.menuItemImage)" 
                      [alt]="item.menuItemName"
                      (error)="onImageError($event)"
                    />
                  </div>
                  <div class="cart-item-content">
                    <div class="cart-item-info">
                      <h6 class="cart-item-name">{{ item.menuItemName }}</h6>
                      <p class="cart-item-details text-muted small mb-2">
                        {{ item.portionName }} - {{ item.portionDetailName }}
                      </p>
                      <div class="cart-item-price-section">
                        <span class="price">{{ formatPrice(item.price) }}</span>
                        <span class="quantity-indicator">x{{ item.quantity }}</span>
                      </div>
                    </div>
                    <div class="cart-item-actions">
                      <div class="quantity-controls">
                        <button 
                          class="btn btn-sm quantity-btn"
                          (click)="updateQuantity(item, -1)"
                          [disabled]="item.quantity <= 1">
                          <i class="bi bi-dash"></i>
                        </button>
                        <span class="quantity">{{ item.quantity }}</span>
                        <button 
                          class="btn btn-sm quantity-btn"
                          (click)="updateQuantity(item, 1)">
                          <i class="bi bi-plus"></i>
                        </button>
                      </div>
                      <button 
                        class="btn btn-link text-danger p-0 remove-btn"
                        (click)="removeFromCart(item)"
                        title="Remove">
                        <i class="bi bi-x-lg"></i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Empty Cart -->
              <div class="empty-cart text-center py-4" *ngIf="cartItems.length === 0">
                <i class="bi bi-cart-x fs-1 text-muted"></i>
                <p class="text-muted mb-0 mt-2">Your cart is empty</p>
              </div>

              <!-- Cart Footer -->
              <div class="cart-footer" *ngIf="cartItems.length > 0">
                <div class="cart-summary">
                  <div class="summary-row">
                    <span>Subtotal:</span>
                    <span class="summary-value">{{ formatPrice(getSubtotal()) }}</span>
                  </div>
                  <div class="summary-row">
                    <span>Delivery Charges:</span>
                    <span class="summary-value">{{ formatPrice(getDeliveryCharges()) }}</span>
                  </div>
                  <div class="summary-row total-row">
                    <span><strong>Total:</strong></span>
                    <span class="summary-value"><strong>{{ formatPrice(getTotal()) }}</strong></span>
                  </div>
                </div>
                <div class="cart-actions">
                  <button class="btn btn-primary w-100 checkout-btn" routerLink="/checkout" (click)="closeDropdowns()">
                    Proceed to Checkout
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Auth Section -->
          <div class="auth-wrapper" (appClickOutside)="closeDropdowns()">
            <!-- Sign In / Register Button (if not logged in) -->
            <button 
              *ngIf="!customerAuthService.isAuthenticated"
              (click)="openAuthModal(); $event.preventDefault(); $event.stopPropagation()"
              class="signin-btn"
              type="button">
              Sign In / Register
            </button>

            <!-- Profile Avatar with Dropdown (if logged in) -->
            <div class="profile-menu" *ngIf="customerAuthService.isAuthenticated && currentCustomer">
              <button 
                class="profile-btn"
                (click)="toggleUserMenu()"
                type="button"
                [attr.aria-expanded]="isUserMenuOpen"
                aria-label="User menu">
                <img 
                  [src]="getProfileAvatarUrl()"
                  [alt]="currentCustomer.fullName || 'Profile'"
                  class="profile-avatar"
                  (error)="onAvatarError($event)">
              </button>

              <!-- Profile Dropdown Menu -->
              <div class="user-dropdown" [class.show]="isUserMenuOpen">
                <div class="dropdown-header">
                  <div class="user-info">
                    <div class="user-name">{{ currentCustomer.fullName }}</div>
                    <div class="user-email" *ngIf="currentCustomer.email">{{ currentCustomer.email }}</div>
                    <div class="user-phone" *ngIf="!currentCustomer.email">{{ currentCustomer.phone }}</div>
                  </div>
                </div>
                <hr class="dropdown-divider">
                <a class="dropdown-item" routerLink="/profile" (click)="closeDropdowns()">
                  <i class="bi bi-person me-2"></i>
                  Profile
                </a>
                <a class="dropdown-item" [routerLink]="['/orders', currentCustomer.customerId]" (click)="closeDropdowns()">
                  <i class="bi bi-bag me-2"></i>
                  My Orders
                </a>
                <a class="dropdown-item" routerLink="/settings" (click)="closeDropdowns()">
                  <i class="bi bi-gear me-2"></i>
                  Settings
                </a>
                <hr class="dropdown-divider">
                <button class="dropdown-item text-danger" (click)="onLogout()">
                  <i class="bi bi-box-arrow-right me-2"></i>
                  Logout
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>

<!-- Slider Section (after header-top-section, not sticky) -->
<div class="slider-container w-100" *ngIf="sliderImages && sliderImages.length > 0 && !isCheckoutPage && !isOrdersPage">
  <div class="slider-wrapper position-relative w-100">
    <button class="slider-nav-btn slider-prev d-none d-md-flex" (click)="prevSlide()" aria-label="Previous slide" type="button">
      <i class="bi bi-chevron-left"></i>
    </button>
    
    <div class="slider-content w-100">
      <div 
        class="slider-slide" 
        *ngFor="let image of sliderImages; let i = index"
        [class.active]="i === currentSlideIndex"
      >
        <img 
          [src]="getSliderImageUrl(image)" 
          [alt]="'Slide ' + (i + 1)"
          (error)="onImageError($event)"
          loading="eager"
          class="w-100 h-100"
        />
      </div>
    </div>
    
    <button class="slider-nav-btn slider-next d-none d-md-flex" (click)="nextSlide()" aria-label="Next slide" type="button">
      <i class="bi bi-chevron-right"></i>
    </button>
  </div>
  
  <!-- Slider Indicators -->
  <div class="slider-indicators d-flex justify-content-center py-2 py-md-3">
    <button 
      *ngFor="let image of sliderImages; let i = index"
      class="slider-indicator"
      [class.active]="i === currentSlideIndex"
      (click)="goToSlide(i)"
      [attr.aria-label]="'Go to slide ' + (i + 1)"
      type="button"
    ></button>
  </div>
</div>

<!-- Section 2: Category Tabs Navigation (sticky) -->
<div class="header-categories-section" *ngIf="!isCheckoutPage && !isOrdersPage">
  <div class="header-container">
    <div class="category-tabs-container">
      <button
        class="category-tab"
        [class.active]="selectedCategoryId === null"
        (click)="selectCategory(null)"
        type="button">
        All
      </button>
      <button
        *ngFor="let category of categories"
        class="category-tab"
        [class.active]="selectedCategoryId === category.id"
        (click)="selectCategory(category.id)"
        type="button">
        {{ category.name }}
      </button>
      <div class="category-arrow">
        <i class="bi bi-chevron-right"></i>
      </div>
    </div>
  </div>
</div>

<!-- Section 3: Search Bar -->
<div class="header-search-section" *ngIf="!isCheckoutPage && !isOrdersPage">
  <div class="header-container">
    <div class="search-container">
      <i class="bi bi-search search-icon"></i>
      <input
        type="text"
        class="search-input"
        placeholder="Search for Kabab St"
        [(ngModel)]="searchTerm"
        (keyup.enter)="onSearch()">
    </div>
  </div>
</div>

<!-- Auth Modal -->
<app-auth-modal
  *ngIf="showAuthModal"
  (close)="closeAuthModal()"
  (success)="onAuthSuccess()">
</app-auth-modal>
